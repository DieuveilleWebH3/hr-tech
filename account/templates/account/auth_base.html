{% load static %}
<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>{% block title%}{% endblock %}</title>
    <!-- Custom fonts for this template-->
    <link href="{% static 'vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <!-- Custom styles for this template-->
    <link href="{% static 'css/sb-admin-2.min.css' %}" rel="stylesheet">

  </head>

  <body class="bg-gradient-primary">
    <div class="container">
      <!-- Outer Row -->
      <div class="row justify-content-center">
        <div class="col-xl-10 col-lg-12 col-md-9">
          <div class="card o-hidden border-0 shadow-lg my-5">
            {% block content %} {% endblock %}
          </div>
        </div>
      </div>
    </div>
    <!-- Bootstrap core JavaScript-->
    <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'endor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <!-- Core plugin JavaScript-->
    <script src="{% static 'vendor/jquery-easing/jquery.easing.min.js' %}"></script>
    <!-- Custom scripts for all pages-->
    <script src="{% static 'js/sb-admin-2.min.js' %}"></script>
    <!-- Narrow down business domain and workstream based on user selection -->
    <script type="text/javascript">
      $(document).ready(function(){
        console.log('ready')
        $("#id_business_unit").change(function() 
        {
          var url = $("#id_user_form").attr("data-filter-list");
          var business_unit = $(this).val();
          console.log(url)
          $.ajax({                       // initialize an AJAX request
            url: url,                    // set the url of the request 
            data: {
              'business_unit': business_unit       
            },
            success: function (data) {
              // `data` is the return of the url view function
              console.log("response_data "+data.work_streams); 
              //console.log(typeof data.work_streams[0])
              //convert from object to int 
              var business_domain = data.business_domain.map(numStr => parseInt(numStr))
              var work_streams = data.work_streams.map(numStr => parseInt(numStr))

              // get all options
              var wsoptions= $('#id_work_stream option').map(function() { return $(this).val(); }).get();

              var bdoptions= $('#id_business_domain option').map(function() { return $(this).val(); }).get();

              // loop through options
              jQuery.each(bdoptions, function(item) 
              { 
                console.log(item)
                // check if the option value is present in list of work_stream
                var check= jQuery.inArray(item,business_domain);
                console.log("match "+check)
                if (check < 0)
                {
                  $("#id_business_domain option[value=" + item + "]").hide();
                }
                else
                {
                  $("#id_business_domain option[value=" + item + "]").show();
                }
              });

              // loop through options
              jQuery.each(wsoptions, function(item) 
              { 
                console.log(item)
                // check if the option value is present in list of work_stream
                var check= jQuery.inArray(item,work_streams);
                console.log("match "+check)
                if (check < 0)
                {
                  $("#id_work_stream option[value=" + item + "]").hide();
                }
                else
                {
                  $("#id_work_stream option[value=" + item + "]").show();
                }
              });
            },
            error: function (error) {
              console.log(error)
            }
          });      
        })

        $("#id_business_domain").change(function() 
        {
          var url = $("#id_user_form").attr("data-filter-list");
          var business_domain = $(this).val();
          console.log(url)
          $.ajax({                       // initialize an AJAX request
            url: url,                    // set the url of the request 
            data: {
              'business_domain': business_domain       
            },
            success: function (data) {
              // `data` is the return of the url view function
              console.log("response_data "+data.work_streams); 
              //console.log(typeof data.work_streams[0])
              //convert from object to int 
              var work_streams = data.work_streams.map(numStr => parseInt(numStr))
              console.log('work_stream '+ work_streams[1] + '- type: '+typeof work_streams[1])

              // get all options
              var wsoptions= $('#id_work_stream option').map(function() { return $(this).val(); }).get();
              console.log("all_options "+wsoptions);

              // loop through options
              jQuery.each(wsoptions, function(item) 
              { 
                console.log(item)
                // check if the option value is present in list of work_stream
                var check= jQuery.inArray(item,work_streams);
                console.log("match "+check)
                if (check < 0) 
                {
                  $("#id_work_stream option[value=" + item + "]").hide();
                }
                else
                {
                  $("#id_work_stream option[value=" + item + "]").show();
                }
              });
            },
            error: function (error) {
              console.log(error)
            }
          });      
        })
      }); 
      
  </script>
  </body>
</html>
